#!/bin/bash

###############################################################################
# å¿«é€ŸæŸ¥è¯¢éªŒè¯é“¾æ¥ - ä¸€è¡Œå‘½ä»¤æŸ¥çœ‹æ‰€æœ‰éªŒè¯é“¾æ¥
# ä½¿ç”¨: bash QUICK_CHECK_LINKS.sh
###############################################################################

echo ""
echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘  KYC éªŒè¯é“¾æ¥ - å¿«é€ŸæŸ¥è¯¢                                 â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# æŸ¥è¯¢æ‰€æœ‰éªŒè¯é“¾æ¥
echo "ğŸ“Š æ­£åœ¨æŸ¥è¯¢æ‰€æœ‰éªŒè¯é“¾æ¥..."
echo ""

docker exec kyc_postgres psql -U kyc_user -d kyc_db -c "
SELECT 
    o.taobao_order_id as è®¢å•ID,
    o.buyer_name as ä¹°å®¶,
    v.status as çŠ¶æ€,
    v.verification_link as éªŒè¯é“¾æ¥,
    v.created_at as åˆ›å»ºæ—¶é—´
FROM orders o
LEFT JOIN verifications v ON o.id = v.order_id
ORDER BY o.created_at DESC;" 2>/dev/null || {
    echo "âŒ è¿æ¥æ•°æ®åº“å¤±è´¥"
    echo ""
    echo "å°è¯•ä»¥ä¸‹æ–¹æ³•:"
    echo "1. æ£€æŸ¥å®¹å™¨æ˜¯å¦è¿è¡Œ: docker ps"
    echo "2. æŸ¥çœ‹æ—¥å¿—: docker logs kyc_postgres"
    echo "3. é‡å¯æœåŠ¡: docker-compose restart"
    exit 1
}

echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""
echo "ğŸ’¡ æç¤º:"
echo "  â€¢ éªŒè¯é“¾æ¥å°±æ˜¯ 'verification_link' åˆ—ä¸­çš„ URL"
echo "  â€¢ å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€è¿™ä¸ªé“¾æ¥"
echo "  â€¢ å¦‚æœæ²¡æœ‰è®°å½•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºæµ‹è¯•è®¢å•:"
echo ""
echo "    curl -X POST http://localhost:5000/webhook/taobao/order \\"
echo "      -H 'Content-Type: application/json' \\"
echo "      -d '{\"order_id\":\"test_123\",\"buyer_name\":\"å¼ ä¸‰\",\"buyer_email\":\"test@test.com\",\"buyer_phone\":\"13800138000\",\"order_amount\":1000}'"
echo ""
echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
